<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3c.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>localStorage Test</title>
		<meta charset="gb2312"/>
		<style type="text/css">

		</style>
	</head>
	<body>
		<label>Key：<input id="key"></label>&nbsp;&nbsp;&nbsp;
		<label>Value：<input id="value"></label><br>
		<button onclick="setItem()">setItem</button>&nbsp;
		<button onclick="getItem()">getItem</button>&nbsp;
		<button onclick="removeItem()">removeItem</button>&nbsp;
		<button onclick="doClear()">clear</button>&nbsp;
		<button onclick="getKey()">key(0)</button>&nbsp;&nbsp;&nbsp;&nbsp;
		<button onclick="getLength()">length</button>&nbsp;
		<button onclick="getRemainSpace()">remain space</button>&nbsp;
		<div id="test">

		</div>
		<iframe src="localStorage.html"></iframe>
	</body>
	<script type="text/javascript">
	/*<![CDATA[*/
		function $(id){
			return document.getElementById(id);
		}
		function setItem(){
			var k = $('key').value,
				v = $('value').value;
			localStorage.setItem(k,v);
			location.href = location.href;
		}
		function getItem(){
			var k = $('key').value;
			alert(localStorage.getItem(k));
		}
		function removeItem(){
			var k = $('key').value;
			localStorage.removeItem(k);
			location.href = location.href;
		}
		function doClear(){
			localStorage.clear();
			location.href = location.href;
		}
		function getKey(){
			alert('The 1st key is: ' + localStorage.key(0));
		}
		function getLength(){
			alert('The localStorage length is: ' + localStorage.length);
		}
		function getRemainSpace(){
			alert('The remain space is: ' + localStorage.remainingSpace);
		}
		window.onload = function(){
			var res = ['localStorage.length: ' + localStorage.length];
			for( var i = localStorage.length; i--; ){
				var k = localStorage.key(i);
				res.push(k + ': ' + localStorage.getItem(k));
			}
			$('test').innerHTML = res.join('<br>');
			function storageHandle(e){
				e = e || window.storageEvent;
				alert(e);
			}
			document.onstorage  = function(e){
				location.href = location.href;
			}
			if( document.attachEvent )
				document.attachEvent('onstorage',storageHandle);
			else if( document.addEventListener ){
				document.addEventListener('storage',storageHandle,false);
				document.body.addEventListener('storage',storageHandle,false);
			}

		}
	//]]>
	</script>
</html>

